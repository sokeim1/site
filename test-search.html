<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ - CineHub</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        
        .test-container {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        input, button {
            padding: 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
        }
        
        input {
            background: #0f3460;
            color: white;
            width: 300px;
        }
        
        button {
            background: #64b5f6;
            color: white;
            cursor: pointer;
        }
        
        button:hover {
            background: #42a5f5;
        }
        
        .results {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .movie-item {
            background: #1a1a2e;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        
        .console-output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤</h1>
    
    <div class="test-container">
        <h2>–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã</h2>
        <button onclick="testAPI()">–¢–µ—Å—Ç API</button>
        <button onclick="testSearch('–∏–≥—Ä–∞')">–ü–æ–∏—Å–∫ "–∏–≥—Ä–∞"</button>
        <button onclick="testSearch('–∫–∞–ª—å–º–∞—Ä')">–ü–æ–∏—Å–∫ "–∫–∞–ª—å–º–∞—Ä"</button>
        <button onclick="testSearch('–∏–≥—Ä–∞ –≤ –∫–∞–ª—å–º–∞—Ä–∞')">–ü–æ–∏—Å–∫ "–∏–≥—Ä–∞ –≤ –∫–∞–ª—å–º–∞—Ä–∞"</button>
        <button onclick="findSquidGame()">–ù–∞–π—Ç–∏ –ò–≥—Ä—É –≤ –∫–∞–ª—å–º–∞—Ä–∞</button>
        <button onclick="checkMovieTitles(10)">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∏–ª—å–º–æ–≤</button>
        <button onclick="checkPage(1)">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É 1</button>
        <button onclick="debugFirstMovies()">DEBUG: –ü–µ—Ä–≤—ã–µ —Ñ–∏–ª—å–º—ã</button>
        <button onclick="checkCacheStatus()">–°—Ç–∞—Ç—É—Å –∫—ç—à–∞</button>
        <button onclick="clearDatabaseCache()">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ë–î</button>
    </div>
    
    <div class="test-container">
        <h2>–†—É—á–Ω–æ–π –ø–æ–∏—Å–∫</h2>
        <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞..." value="–∏–≥—Ä–∞ –≤ –∫–∞–ª—å–º–∞—Ä–∞">
        <button onclick="manualSearch()">–ü–æ–∏—Å–∫</button>
    </div>
    
    <div class="test-container">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
        <div id="results" class="results">
            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...
        </div>
    </div>
    
    <div class="test-container">
        <h2>–ö–æ–Ω—Å–æ–ª—å</h2>
        <div id="console" class="console-output">
            –õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º API -->
    <script src="js/api.js"></script>
    
    <script>
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f44336' : type === 'warn' ? '#ff9800' : '#4caf50';
            consoleDiv.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('ERROR: ' + args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole('WARN: ' + args.join(' '), 'warn');
        };
        
        // –§—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        async function testAPI() {
            console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º API...');
            showResults('–¢–µ—Å—Ç–∏—Ä—É–µ–º API...');
            
            try {
                const result = await movieAPI.getPageWithCache(1, 20, {});
                console.log('API —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                
                if (result && result.data && result.data.length > 0) {
                    showResults(`‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ–ª—É—á–µ–Ω–æ ${result.data.length} —Ñ–∏–ª—å–º–æ–≤`);
                    console.log('–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å–º–æ–≤:');
                    result.data.slice(0, 5).forEach((movie, i) => {
                        console.log(`${i+1}. ${movie.name_rus || movie.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}`);
                    });
                } else {
                    showResults('‚ùå API –Ω–µ –≤–µ—Ä–Ω—É–ª –¥–∞–Ω–Ω—ã–µ');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ API:', error);
                showResults('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ API: ' + error.message);
            }
        }
        
        async function testSearch(query) {
            console.log(`üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫: "${query}"`);
            showResults(`–ò—â–µ–º "${query}"...`);
            
            try {
                const result = await movieAPI.searchMovies(query);
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞:', result);
                
                if (result && result.data) {
                    const movies = result.data;
                    showResults(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${movies.length} —Ñ–∏–ª—å–º–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${query}"`);
                    
                    if (movies.length > 0) {
                        let html = `<h3>–ù–∞–π–¥–µ–Ω–æ ${movies.length} —Ñ–∏–ª—å–º–æ–≤:</h3>`;
                        movies.slice(0, 10).forEach((movie, i) => {
                            html += `<div class="movie-item">
                                ${i+1}. <strong>${movie.name_rus || movie.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</strong>
                                ${movie.year ? ` (${movie.year})` : ''}
                                ${movie.kp_rating ? ` - ‚≠ê ${movie.kp_rating}` : ''}
                            </div>`;
                        });
                        showResults(html);
                    }
                } else {
                    showResults('‚ùå –ü–æ–∏—Å–∫ –Ω–µ –≤–µ—Ä–Ω—É–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
                showResults('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ: ' + error.message);
            }
        }
        
        async function checkPage(page) {
            console.log(`üìÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É ${page}`);
            showResults(`–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É ${page}...`);
            
            try {
                const result = await movieAPI.getPageWithCache(page, 20, {});
                console.log(`–î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, result);
                
                if (result && result.data) {
                    showResults(`‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${page} —Å–æ–¥–µ—Ä–∂–∏—Ç ${result.data.length} —Ñ–∏–ª—å–º–æ–≤`);
                } else {
                    showResults(`‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${page} –ø—É—Å—Ç–∞—è –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', error);
                showResults('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ' + error.message);
            }
        }
        
        async function manualSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                showResults('‚ùå –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞');
                return;
            }
            
            await testSearch(query);
        }
        
        async function checkMovieTitles(pages = 10) {
            console.log(`üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∏–ª—å–º–æ–≤ –Ω–∞ –ø–µ—Ä–≤—ã—Ö ${pages} —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö...`);
            showResults(`üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∏–ª—å–º–æ–≤ –Ω–∞ –ø–µ—Ä–≤—ã—Ö ${pages} —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö...`);
            
            const allTitles = [];
            for (let page = 1; page <= pages; page++) {
                try {
                    const result = await movieAPI.getPageWithCache(page, 100, {});
                    if (result && result.data) {
                        result.data.forEach(movie => {
                            const titles = [
                                movie.name_rus,
                                movie.name_eng,
                                movie.name,
                                movie.name_original
                            ].filter(Boolean);
                            
                            allTitles.push({
                                id: movie.id,
                                titles: titles,
                                mainTitle: movie.name_rus || movie.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'
                            });
                        });
                    }
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, error);
                }
            }
            
            console.log(`üìä –ù–∞–π–¥–µ–Ω–æ ${allTitles.length} —Ñ–∏–ª—å–º–æ–≤`);
            
            // –ò—â–µ–º —Ñ–∏–ª—å–º—ã —Å–æ —Å–ª–æ–≤–∞–º–∏ "–∏–≥—Ä–∞", "–∫–∞–ª—å–º–∞—Ä", "squid", "game"
            const keywords = ['–∏–≥—Ä–∞', '–∫–∞–ª—å–º–∞—Ä', 'squid', 'game'];
            let resultsHtml = `<h3>üìä –ù–∞–π–¥–µ–Ω–æ ${allTitles.length} —Ñ–∏–ª—å–º–æ–≤</h3>`;
            
            keywords.forEach(keyword => {
                const matches = allTitles.filter(movie => 
                    movie.titles.some(title => 
                        title.toLowerCase().includes(keyword.toLowerCase())
                    )
                );
                
                console.log(`üîç –§–∏–ª—å–º—ã —Å "${keyword}": ${matches.length}`);
                resultsHtml += `<h4>üîç –§–∏–ª—å–º—ã —Å "${keyword}": ${matches.length}</h4>`;
                
                matches.slice(0, 5).forEach(movie => {
                    console.log(`  - ${movie.mainTitle}`);
                    resultsHtml += `<div class="movie-item">- ${movie.mainTitle}</div>`;
                });
            });
            
            showResults(resultsHtml);
            return allTitles;
        }
        
        async function findSquidGame() {
            console.log('ü¶ë Searching for "Squid Game" / "–ò–≥—Ä–∞ –≤ –∫–∞–ª—å–º–∞—Ä–∞"...');
            showResults('ü¶ë –ò—â–µ–º "–ò–≥—Ä—É –≤ –∫–∞–ª—å–º–∞—Ä–∞" —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏...');
            
            const queries = [
                '–∏–≥—Ä–∞ –≤ –∫–∞–ª—å–º–∞—Ä–∞',
                'squid game', 
                '–∏–≥—Ä–∞ –∫–∞–ª—å–º–∞—Ä–∞',
                '–∫–∞–ª—å–º–∞—Ä',
                'squid'
            ];
            
            for (const query of queries) {
                console.log(`üîç Trying query: "${query}"`);
                try {
                    const result = await movieAPI.searchMovies(query);
                    if (result && result.data && result.data.length > 0) {
                        console.log(`‚úÖ Found ${result.data.length} results for "${query}":`);
                        result.data.slice(0, 3).forEach((movie, i) => {
                            console.log(`${i+1}. ${movie.name_rus || movie.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}`);
                        });
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                        const exactMatch = result.data.find(movie => {
                            const titles = [
                                movie.name_rus,
                                movie.name_eng, 
                                movie.name,
                                movie.name_original
                            ].filter(Boolean).map(t => t.toLowerCase());
                            
                            return titles.some(title => 
                                (title.includes('–∏–≥—Ä–∞') && title.includes('–∫–∞–ª—å–º–∞—Ä')) ||
                                (title.includes('squid') && title.includes('game'))
                            );
                        });
                        
                        if (exactMatch) {
                            console.log(`üéØ FOUND SQUID GAME: ${exactMatch.name_rus || exactMatch.name}`);
                            showResults(`üéØ –ù–ê–ô–î–ï–ù–ê "–ò–ì–†–ê –í –ö–ê–õ–¨–ú–ê–†–ê"!<br><strong>${exactMatch.name_rus || exactMatch.name}</strong><br>–ó–∞–ø—Ä–æ—Å: "${query}"`);
                            return exactMatch;
                        }
                    } else {
                        console.log(`‚ùå No results for "${query}"`);
                    }
                } catch (error) {
                    console.error(`Error searching "${query}":`, error);
                }
            }
            
            console.log('‚ùå Squid Game not found with any query');
            showResults('‚ùå "–ò–≥—Ä–∞ –≤ –∫–∞–ª—å–º–∞—Ä–∞" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∏ –æ–¥–Ω–∏–º –∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤');
            return null;
        }
        
        function showResults(html) {
            document.getElementById('results').innerHTML = html;
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç—ã...');
            setTimeout(() => {
                testAPI();
            }, 1000);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                manualSearch();
            }
        });
    </script>
</body>
</html>
